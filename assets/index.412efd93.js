(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();let D;const ie=new Uint8Array(16);function ne(){if(!D&&(D=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(ie)}const p=[];for(let t=0;t<256;++t)p.push((t+256).toString(16).slice(1));function oe(t,e=0){return(p[t[e+0]]+p[t[e+1]]+p[t[e+2]]+p[t[e+3]]+"-"+p[t[e+4]]+p[t[e+5]]+"-"+p[t[e+6]]+p[t[e+7]]+"-"+p[t[e+8]]+p[t[e+9]]+"-"+p[t[e+10]]+p[t[e+11]]+p[t[e+12]]+p[t[e+13]]+p[t[e+14]]+p[t[e+15]]).toLowerCase()}const re=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z={randomUUID:re};function V(t,e,s){if(z.randomUUID&&!e&&!t)return z.randomUUID();t=t||{};const i=t.random||(t.rng||ne)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){s=s||0;for(let o=0;o<16;++o)e[s+o]=i[o];return e}return oe(i)}const R=()=>new Map,le=(t,e,s)=>{let i=t.get(e);return i===void 0&&t.set(e,i=s()),i},ae=()=>new Set,ce=Array.from;class Y{constructor(){this._observers=R()}on(e,s){le(this._observers,e,ae).add(s)}once(e,s){const i=(...o)=>{this.off(e,i),s(...o)};this.on(e,i)}off(e,s){const i=this._observers.get(e);i!==void 0&&(i.delete(s),i.size===0&&this._observers.delete(e))}emit(e,s){return ce((this._observers.get(e)||R()).values()).forEach(i=>i(...s))}destroy(){this._observers=R()}}var P={exports:{}},U,K;function he(){if(K)return U;K=1;var t=1e3,e=t*60,s=e*60,i=s*24,o=i*7,l=i*365.25;U=function(n,r){r=r||{};var h=typeof n;if(h==="string"&&n.length>0)return d(n);if(h==="number"&&isFinite(n))return r.long?a(n):c(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function d(n){if(n=String(n),!(n.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!!r){var h=parseFloat(r[1]),f=(r[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*l;case"weeks":case"week":case"w":return h*o;case"days":case"day":case"d":return h*i;case"hours":case"hour":case"hrs":case"hr":case"h":return h*s;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function c(n){var r=Math.abs(n);return r>=i?Math.round(n/i)+"d":r>=s?Math.round(n/s)+"h":r>=e?Math.round(n/e)+"m":r>=t?Math.round(n/t)+"s":n+"ms"}function a(n){var r=Math.abs(n);return r>=i?u(n,r,i,"day"):r>=s?u(n,r,s,"hour"):r>=e?u(n,r,e,"minute"):r>=t?u(n,r,t,"second"):n+" ms"}function u(n,r,h,f){var g=r>=h*1.5;return Math.round(n/h)+" "+f+(g?"s":"")}return U}function de(t){s.debug=s,s.default=s,s.coerce=a,s.disable=l,s.enable=o,s.enabled=d,s.humanize=he(),s.destroy=u,Object.keys(t).forEach(n=>{s[n]=t[n]}),s.names=[],s.skips=[],s.formatters={};function e(n){let r=0;for(let h=0;h<n.length;h++)r=(r<<5)-r+n.charCodeAt(h),r|=0;return s.colors[Math.abs(r)%s.colors.length]}s.selectColor=e;function s(n){let r,h=null,f,g;function _(...m){if(!_.enabled)return;const v=_,w=Number(new Date),ee=w-(r||w);v.diff=ee,v.prev=r,v.curr=w,r=w,m[0]=s.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let E=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(N,te)=>{if(N==="%%")return"%";E++;const $=s.formatters[te];if(typeof $=="function"){const se=m[E];N=$.call(v,se),m.splice(E,1),E--}return N}),s.formatArgs.call(v,m),(v.log||s.log).apply(v,m)}return _.namespace=n,_.useColors=s.useColors(),_.color=s.selectColor(n),_.extend=i,_.destroy=s.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==s.namespaces&&(f=s.namespaces,g=s.enabled(n)),g),set:m=>{h=m}}),typeof s.init=="function"&&s.init(_),_}function i(n,r){const h=s(this.namespace+(typeof r>"u"?":":r)+n);return h.log=this.log,h}function o(n){s.save(n),s.namespaces=n,s.names=[],s.skips=[];let r;const h=(typeof n=="string"?n:"").split(/[\s,]+/),f=h.length;for(r=0;r<f;r++)!h[r]||(n=h[r].replace(/\*/g,".*?"),n[0]==="-"?s.skips.push(new RegExp("^"+n.slice(1)+"$")):s.names.push(new RegExp("^"+n+"$")))}function l(){const n=[...s.names.map(c),...s.skips.map(c).map(r=>"-"+r)].join(",");return s.enable(""),n}function d(n){if(n[n.length-1]==="*")return!0;let r,h;for(r=0,h=s.skips.length;r<h;r++)if(s.skips[r].test(n))return!1;for(r=0,h=s.names.length;r<h;r++)if(s.names[r].test(n))return!0;return!1}function c(n){return n.toString().substring(2,n.toString().length-2).replace(/\.\*\?$/,"*")}function a(n){return n instanceof Error?n.stack||n.message:n}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}var ue=de;(function(t,e){e.formatArgs=i,e.save=o,e.load=l,e.useColors=s,e.storage=d(),e.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;a.splice(1,0,u,"color: inherit");let n=0,r=0;a[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(n++,h==="%c"&&(r=n))}),a.splice(r,0,u)}e.log=console.debug||console.log||(()=>{});function o(a){try{a?e.storage.setItem("debug",a):e.storage.removeItem("debug")}catch{}}function l(){let a;try{a=e.storage.getItem("debug")}catch{}return!a&&typeof process<"u"&&"env"in process&&(a=process.env.DEBUG),a}function d(){try{return localStorage}catch{}}t.exports=ue(e);const{formatters:c}=t.exports;c.j=function(a){try{return JSON.stringify(a)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(P,P.exports);const L=P.exports;function C(t,e){return Number.parseFloat(t.toFixed(e||3))}function k(t){return{x:t.x,y:t.y}}function fe(t,e){return{x:C(t.x+e.x),y:C(t.y+e.y)}}function T(t,e,s){const i=C(Math.max(0,Math.min(1,Number(s))));return C(t+i*(e-t))}function G(t,e,s){return{x:T(t.x,e.x,s),y:T(t.y,e.y,s)}}class _e{constructor(e){this.id=V(),this.events=new Y,this.opts={world:{maxPlayers:2,width:720,height:480},client:{show_help:!1,naive_approach:!1,show_server_pos:!1,show_dest_pos:!1,client_predict:!1,client_smoothing:!0,client_smooth:25},net_latency:.001,net_ping:.001,last_ping_time:.001,fake_lag:0,fake_lag_time:0},this.updateid=0,this.dt=0,this.lastframetime=0,this._pdt=1e-4,this._pdte=new Date().getTime(),this.local_time=.016,this._dt=new Date().getTime(),this._dte=new Date().getTime(),this.server=!1,this.color="",this.server_time=Date.now(),this.requestAnimationFrame=(s,i)=>{if(typeof window<"u")return window.requestAnimationFrame(s);{let o=0;const l=45,d=Date.now(),c=Math.max(0,l-(d-o)),a=setTimeout(()=>{s(d+c)},c);return o=d+c,a}},this.cancelAnimationFrame=s=>{typeof window<"u"?window.cancelAnimationFrame(s):clearTimeout(s)},e&&(this.opts={...this.opts,...e}),this._pdt=1e-4,this._pdte=new Date().getTime(),this.local_time=.016,this._dt=new Date().getTime(),this._dte=new Date().getTime(),this.create_physics_simulation(),this.create_timer()}setOptions(e){this.opts=e}update(e){this.dt=this.lastframetime?C((e-this.lastframetime)/1e3):.016,this.lastframetime=e,this.server?this.on_tick():this.client_update(),this.updateid=this.requestAnimationFrame(this.update.bind(this))}create_timer(){clearInterval(this.timerInterval),this.timerInterval=setInterval(()=>{this._dt=new Date().getTime()-this._dte,this._dte=new Date().getTime(),this.local_time+=this._dt/1e3},4)}create_physics_simulation(){clearInterval(this.physicsInterval),this.physicsInterval=setInterval(()=>{this._pdt=(new Date().getTime()-this._pdte)/1e3,this._pdte=new Date().getTime(),this.events.emit("physics",[])},15)}on_tick(){}client_update(){}client_create_configuration(){}client_connect_to_server(){}client_create_ping_timer(){}}const pe=["shift","ctrl","alt","meta"],H={left:37,up:38,right:39,down:40,space:32,pageup:33,pagedown:34,tab:9};class W{constructor(){this.keyCodes={},this.modifiers={shift:!1,ctrl:!1,alt:!1,meta:!1},this._onKeyDown=e=>{this._onKeyChange(e,!0)},this._onKeyUp=e=>{this._onKeyChange(e,!1)},document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("keyup",this._onKeyUp,!1)}destroy(){document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)}_onKeyChange(e,s){const i=e.keyCode;this.keyCodes[i]=s,this.modifiers.shift=e.shiftKey,this.modifiers.ctrl=e.ctrlKey,this.modifiers.alt=e.altKey,this.modifiers.meta=e.metaKey}pressed(e){const s=e.split("+");for(let o=0;o<s.length;o++){const l=s[o];var i;if(pe.indexOf(l)!==-1?i=this.modifiers[l]:Object.keys(H).indexOf(l)!=-1?i=this.keyCodes[H[l]]:i=this.keyCodes[l.toUpperCase().charCodeAt(0)],!i)return!1}return!0}}class J{constructor(e,s){this.isHost=!1,this.inputs=[],this.last_input_time=0,this.last_input_seq=0,this.online=!1,this.playerId=e,this.pos={x:0,y:0},this.ghostPos={x:0,y:0},this.size={x:16,y:16,hx:8,hy:8},this.state="not-connected",this.color="rgba(255,255,255,0.1)",this.info_color="rgba(255,255,255,0.1)",this.old_state={pos:{x:0,y:0}},this.cur_state={pos:{x:0,y:0}},this.state_time=new Date().getTime(),this.inputs=[],this.pos_limits={x_min:this.size.hx,x_max:s.width-this.size.hx,y_min:this.size.hy,y_max:s.height-this.size.hy}}resetPos(e){this.pos=e,this.ghostPos=e}draw(e){e.fillStyle=this.color,e.fillRect(this.pos.x-this.size.hx,this.pos.y-this.size.hy,this.size.x,this.size.y),e.fillStyle=this.info_color,e.fillText(this.state,this.pos.x+10,this.pos.y+4)}}const S={playerspeed:120,client:{show_help:!1,naive_approach:!1,show_server_pos:!1,show_dest_pos:!1,client_predict:!0,input_seq:0,client_smoothing:!0,client_smooth:25}};function me(t){return t.pos.x<=t.pos_limits.x_min&&(t.pos.x=t.pos_limits.x_min),t.pos.x>=t.pos_limits.x_max&&(t.pos.x=t.pos_limits.x_max),t.pos.y<=t.pos_limits.y_min&&(t.pos.y=t.pos_limits.y_min),t.pos.y>=t.pos_limits.y_max&&(t.pos.y=t.pos_limits.y_max),t.pos.x=C(t.pos.x),t.pos.y=C(t.pos.y),t}function Z(t,e){{t.old_state.pos=k(t.cur_state.pos);const s=ye(t);t.cur_state.pos=fe(t.old_state.pos,s),t.state_time=e}return t}function ye(t){let e=0,s=0;const i=t.inputs.length;if(i)for(let l=0;l<i;++l){if(t.inputs[l].seq<=t.last_input_seq)continue;const d=t.inputs[l].inputs,c=d.length;for(let a=0;a<c;++a){const u=d[a];u=="l"&&(e-=1),u=="r"&&(e+=1),u=="d"&&(s+=1),u=="u"&&(s-=1)}}const o=Q(e,s);return t.inputs.length&&(t.last_input_time=t.inputs[i-1].time,t.last_input_seq=t.inputs[i-1].seq),o}function Q(t,e){return{x:C(t*(S.playerspeed*.015)),y:C(e*(S.playerspeed*.015))}}function ge(t,e,s,i,o,l){const d=o;let c=null,a=null;for(let f=0;f<t.length-1;++f){const g=t[f],_=t[f+1];if(d>g.t&&d<_.t){c=_,a=g;break}}if(c||(c=t[0],a=t[0]),!c||!a)return e;i=c.t;const u=i-d,n=C(c.t-a.t);let r=C(u/n);isNaN(r)&&(r=0),r==-1/0&&(r=0),r==1/0&&(r=0);const h=t[t.length-1];return e.map(f=>{var g,_;h.players.find(w=>w.playerId===f.playerId);const m=(g=c==null?void 0:c.players.find(w=>w.playerId===f.playerId))===null||g===void 0?void 0:g.pos,v=(_=a==null?void 0:a.players.find(w=>w.playerId===f.playerId))===null||_===void 0?void 0:_.pos;return m&&v&&(f.ghostPos=G(v,m,r)),f.playerId===s||(f.pos=G(f.pos,f.ghostPos,l*S.client.client_smooth)),f})}function Ce(t,e,s,i,o){const d=t[t.length-1].players.find(c=>c.playerId===s);return e.map(c=>{if(c.playerId===s){d&&(c.ghostPos=k(d.pos));const a=c.last_input_seq;let u=-1;for(let n=0;n<c.inputs.length;++n)if(c.inputs[n].seq==a){u=n;break}if(u!==-1){const n=Math.abs(u- -1);c.inputs.splice(0,n),c.cur_state.pos=d?k(d.pos):{x:0,y:0},c.last_input_seq=u,c=Z(c,i),c=X(c,i,o)}}return c})}function X(t,e,s){{(e-t.state_time)/s,t.old_state.pos;const i=t.cur_state.pos;t.pos=i,me(t)}return t}var y;(function(t){t[t.join=0]="join",t[t.leave=1]="leave",t[t.move=2]="move",t[t.ping=3]="ping",t[t.color=4]="color"})(y||(y={}));var b;(function(t){t[t.start_game=0]="start_game",t[t.end_game=1]="end_game",t[t.tick=2]="tick",t[t.client_connected=3]="client_connected",t[t.client_host=4]="client_host",t[t.client_join=5]="client_join",t[t.player_left=6]="player_left",t[t.client_end=7]="client_end",t[t.client_ping=8]="client_ping",t[t.client_color=9]="client_color"})(b||(b={}));class ve extends _e{constructor(e,s,i){super(i),this.keyboard=new W,this.client_has_input=!1,this.server=!1,this.players=[],this.server_updates=[],this.clientEvents=new Y,this.input_seq=0,this.net_offset=100,this.buffer_size=2,this.target_time=.01,this.oldest_tick=.01,this.client_time=.01,this.server_time=.01,this.dt=.016,this.fps=0,this.fps_avg_count=0,this.fps_avg=0,this.fps_avg_acc=0,this.lit=0,this.llt=new Date().getTime(),this.playerId=e,this.viewport=s,this.players.push(new J(e,this.opts.world)),this.events.on("physics",()=>{this.players=this.players.map(o=>o.playerId===this.playerId?Z(o,this.local_time):o)}),this.keyboard=new W,this.client_create_configuration(),this.server_updates=[],this.client_connect_to_server(),this.client_create_ping_timer(),this.color=localStorage.getItem("color")||"#cc8822",localStorage.setItem("color",this.color)}handle_client_keyboard_input(){let e=0,s=0;const i=[];if(this.client_has_input=!1,(this.keyboard.pressed("A")||this.keyboard.pressed("left"))&&(e=-1,i.push("l")),(this.keyboard.pressed("D")||this.keyboard.pressed("right"))&&(e=1,i.push("r")),(this.keyboard.pressed("S")||this.keyboard.pressed("down"))&&(s=1,i.push("d")),(this.keyboard.pressed("W")||this.keyboard.pressed("up"))&&(s=-1,i.push("u")),i.length){this.input_seq+=1,this.players=this.players.map(l=>(l.playerId===this.playerId&&l.inputs.push({inputs:i,time:this.local_time,seq:this.input_seq}),l));const o={playerId:this.playerId,input:i,local_time:this.local_time,input_seq:this.input_seq};return this.emit(y.move,o),Q(e,s)}else return{x:0,y:0}}on_server_tick(e){this.server_time=e.t,this.client_time=this.server_time-this.net_offset/1e3,this.opts.client.naive_approach?this.players=this.players.map(s=>{const i=e.players.find(o=>o.playerId===s.playerId);return i&&(s.pos=i.pos,s.last_input_seq=i.last_input_seq),s}):(this.server_updates.push(e),this.server_updates.length>=60*this.buffer_size&&this.server_updates.splice(0,1),this.oldest_tick=this.server_updates[0].t,this.players=Ce(this.server_updates,this.players,this.playerId,this.local_time,this._pdt))}client_update(){!this.ctx||(this.ctx.clearRect(0,0,720,480),this.client_draw_info(),this.handle_client_keyboard_input(),this.opts.client.naive_approach||(this.players=ge(this.server_updates,this.players,this.playerId,this.target_time,this.client_time,this._pdt)),this.players.forEach(e=>{e.draw(this.ctx),e.playerId===this.playerId&&X(e,this.local_time,this._pdt)}),this.client_refresh_fps())}client_create_ping_timer(){clearInterval(this.pingInterval),this.pingInterval=setInterval(()=>{this.opts.last_ping_time=new Date().getTime()-this.opts.fake_lag,this.emit(y.ping,{ping:this.opts.last_ping_time})},1e3)}client_create_debug_gui(){}client_reset_positions(){this.players=this.players.map(e=>(e.isHost?e.resetPos({x:20,y:20}):e.resetPos({x:500,y:200}),e.playerId===this.playerId&&(e.old_state.pos=k(e.pos),e.pos=k(e.pos),e.cur_state.pos=k(e.pos)),e))}on_player_left(e){console.log("player left"),this.players=this.players.filter(s=>(s.playerId!==e.playerId&&s.playerId===e.newHostId&&(s.isHost=!0,s.info_color="#cc0000",s.state="hosting.waiting for a player",s.online=!0),s.playerId!==e.playerId))}on_client_join_game(e){console.log("client_onjoingame",e);const s=e.players.filter(o=>o.playerId!==this.playerId&&!this.players.find(l=>l.playerId===o.playerId)),i=[...this.players];s.forEach(o=>{const l=new J(o.playerId,this.opts.world);l.info_color=o.color,l.state="connected.joined.waiting",l.isHost=o.isHost,l.pos=o.pos,i.push(l)}),this.players=i.map(o=>(o.isHost?(o.info_color="#2288cc",o.state="local_pos(hosting)"):(o.info_color="#cc8822",o.state="local_pos(joined)"),o.playerId===this.playerId&&(o.state="YOU "+o.state),o.online=!0,o)),this.client_reset_positions()}on_client_host_game(e){console.log("client_onhostgame");const s=parseFloat(e.replace("-","."));this.local_time=s+this.opts.net_latency,this.players=this.players.map(i=>(i.playerId===this.playerId&&(i.info_color="#cc0000",i.state="hosting.waiting for a player",i.online=!0),i)),this.client_reset_positions()}on_connected(e){this.players=this.players.map(s=>(s.playerId===this.playerId&&(s.info_color="#cc0000",s.state="connected",s.online=!0),s))}on_other_client_color_change(e){}on_client_ping(e){this.opts.net_ping=new Date().getTime()-parseFloat(e.ping),this.opts.net_latency=this.opts.net_ping/2}on_disconnect(){this.players=this.players.map(e=>(e.playerId===this.playerId?(e.info_color="rgba(255,255,255,0.1)",e.state="not-connected",e.online=!1):(e.info_color="rgba(255,255,255,0.1)",e.state="not-connected"),e))}client_refresh_fps(){this.fps=1/this.dt,this.fps_avg_acc+=this.fps,this.fps_avg_count++,this.fps_avg_count>=10&&(this.fps_avg=this.fps_avg_acc/10,this.fps_avg_count=1,this.fps_avg_acc=this.fps)}client_draw_info(){!this.ctx||(this.ctx.fillStyle="rgba(255,255,255,0.3)",this.opts.client.show_help&&(this.ctx.fillText('net_offset : local offset of others players and their server updates. Players are net_offset "in the past" so we can smoothly draw them interpolated.',10,30),this.ctx.fillText("server_time : last known game time on server",10,70),this.ctx.fillText("client_time : delayed game time on client for other players only (includes the net_offset)",10,90),this.ctx.fillText("net_latency : Time from you to the server. ",10,130),this.ctx.fillText("net_ping : Time from you to the server and back. ",10,150),this.ctx.fillText("fake_lag : Add fake ping/lag for testing, applies only to your inputs (watch server_pos block!). ",10,170),this.ctx.fillText("client_smoothing/client_smooth : When updating players information from the server, it can smooth them out.",10,210),this.ctx.fillText(" This only applies to other clients when prediction is enabled, and applies to local player with no prediction.",170,230)),this.players.forEach(e=>{e.playerId===this.playerId&&e.isHost&&(this.ctx.fillStyle="rgba(255,255,255,0.7)",this.ctx.fillText("You are the host",10,465))}),this.ctx.fillStyle="rgba(255,255,255,1)")}emit(e,s){this.clientEvents.emit(e,[s])}on(e,s){this.clientEvents.on(e,s)}destroy(){clearInterval(this.timerInterval),clearInterval(this.physicsInterval),clearInterval(this.pingInterval),this.cancelAnimationFrame(this.updateid),this.events.destroy(),this.clientEvents.destroy()}}var B;(function(t){t.WAITING="WAITING",t.RUNNING="RUNNING",t.ENDED="ENDED"})(B||(B={}));const I=L("game"),F={debug(t,e){e?I(`%c DEBUG ${t}`,"color: #c563ff",e):I(`%c DEBUG ${t}`,"color: #c563ff")},info(t,e){e?I(t,e):I(t)},warn(t,e){e?I(`%c WARNING ${t}`,"color: #f3f32c",e):I(`%c WARNING ${t}`,"color: #f3f32c")},error(t,e){e?I(`%c ERROR ${t}`,"color: #ff4242",e):I(`%c ERROR ${t}`,"color: #ff4242")}},M=t=>{t?L.enable("game"):L.disable()};function we(t,e){const s=JSON.parse(t.slice(1).toString()),i=parseInt(t.charAt(0));switch(i){case b.start_game:console.log("start game");break;case b.tick:e.on_server_tick(s);break;case b.client_host:F.debug("Read client host"),e.on_client_host_game(s);break;case b.client_join:F.debug("Read client join"),e.on_client_join_game(s);break;case b.player_left:F.debug("Read client ready"),e.on_player_left(s);break;case b.client_end:F.debug("Read client end"),e.on_disconnect();break;case b.client_ping:e.on_client_ping(s);break;case b.client_color:F.debug("Read client color"),e.on_other_client_color_change(s);break;default:F.error(`Unknown message type: ${i}`)}}function q(t,e){return`${t}${JSON.stringify(e)}`}const be=t=>{if(!t)throw new Error("Undefined environment variable!");return t},xe=be("ws://realtime-multiplayer.fly.dev"),Ie=4e3;let x=null,O=null;M(!1);const A={connect(t,e,s){const i=new URLSearchParams;i.append("playerId",t),x=new WebSocket(`${xe}?${i.toString()}`),x.onopen=()=>{console.log("Socket connected \u{1F680}"),e.on_connected({playerId:t}),s()},x.onerror=o=>{console.debug("socket err!",o)},x.onclose=()=>{e.on_disconnect(),console.log("Socket disconnected \u{1F31A}..."),x=null,this.reconnect(t,e,s)},x.onmessage=o=>{we(o.data,e)}},reconnect(t,e,s){O||(O=setTimeout(()=>{this.connect(t,e,s),O=null},Ie))},emit(t){x==null||x.send(t)}};const j=localStorage.getItem("playerId")||V();M(!0);Fe();function Fe(){const t=document.getElementById("viewport");if(!t)return;const e=new ve(j,t);t.width=e.opts.world.width,t.height=e.opts.world.height;const s=e.viewport.getContext("2d");s&&(e.ctx=s,e.ctx.font='11px "Helvetica"'),e.update(new Date().getTime()),A.connect(j,e,()=>{A.emit(q(y.join,{playerId:j}))}),e.on(y.join,i=>{console.log("join ",i)}),e.on(y.leave,i=>{console.log("leave ",i)}),e.on(y.move,i=>{console.log("move ",i),A.emit(q(y.move,i))}),e.on(y.ping,i=>{A.emit(q(y.ping,i))}),e.on(y.color,i=>{console.log("color ",i)})}
